from pyrogram import Client, filters
from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton, Message

api_id = 28209250
api_hash = "04591eb2063739551aa1841a7a4c6548"
bot_token = "7301001227:AAFY-8nZbtBRD6vccndyK-kU-no1Ah7jLLA"

channel_username = "eviza1404"  # ÙÙ‚Ø· Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ØŒ Ø¨Ø¯ÙˆÙ† @
admin_id = 8112253241           # Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø´Ù…Ø§

app = Client("ali_member_bot", api_id=api_id, api_hash=api_hash, bot_token=bot_token)

@app.on_message(filters.private & ~filters.bot)
async def handle_all_messages(client, message: Message):
    user_id = message.from_user.id
    print("ğŸ“¥ Ù¾ÛŒØ§Ù… Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ Ø§Ø²:", user_id)

    # Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„
    try:
        member = await client.get_chat_member(channel_username, user_id)
        if member.status not in ["member", "administrator", "creator"]:
            raise Exception("Ø¹Ø¶Ùˆ Ù†ÛŒØ³Øª")
    except:
        await message.reply(
            "âŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§ØªØŒ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ù…Ø§ Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯:\n\n"
            "ğŸ“¢ https://t.me/eviza1404",
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("ğŸ“¢ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„", url="https://t.me/eviza1404")]
            ])
        )
        return

    # ÙÙ‚Ø· Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… /start Ø¨ÙˆØ¯ØŒ Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯ Ø¨Ø¯Ù‡
    if message.text == "/start":
        await message.reply(
            "ğŸŸ¢ *Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!*\n\n"
            "Ø¨Ù‡ *Ø±Ø¨Ø§Øª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÛŒØ²Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†* Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.\nØ§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("âœ… Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆÛŒØ²Ø§", url="https://evisatraveller.mfa.ir/fa/request/status/")],
                [InlineKeyboardButton("ğŸ“¢ Ú©Ø§Ù†Ø§Ù„ Ù…Ø§", url="https://t.me/eviza1404")],
                [InlineKeyboardButton("ğŸ’¬ Ú¯Ø±ÙˆÙ‡ Ø¨Ø­Ø« Ùˆ Ø³ÙˆØ§Ù„Ø§Øª", url="https://t.me/Evisa1404")]
            ]),
            parse_mode="Markdown"
        )
        return

    # Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ø¹Ø§Ø¯ÛŒ Ø¨ÙˆØ¯ØŒ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙØ±Ø³Øª
    fwd = await message.forward(admin_id)
    await client.send_message(
        admin_id,
        f"ğŸ‘¤ Ù¾ÛŒØ§Ù… Ø§Ø²: {message.from_user.first_name}\nğŸ†” {message.from_user.id}\nâœ‰ï¸ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®ØŒ Ø±ÙˆÛŒ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø¨Ø²Ù†.",
        reply_to_message_id=fwd.id
    )

@app.on_message(filters.private & filters.reply & filters.user(admin_id))
async def reply_to_user(client, message: Message):
    if not message.reply_to_message or not message.reply_to_message.forward_from:
        await message.reply("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return

    user_id = message.reply_to_message.forward_from.id

    try:
        await client.send_message(user_id, f"ğŸ“© Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ†:\n\n{message.text}")
        await message.reply("âœ… Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
    except:
        await message.reply("âš ï¸ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù…Ú©Ù† Ù†Ø´Ø¯.")

print("ğŸš€ Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª... Ù„Ø·ÙØ§Ù‹ /start Ø±Ø§ Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… Ø¨ÙØ±Ø³ØªÛŒØ¯.")
app.run()